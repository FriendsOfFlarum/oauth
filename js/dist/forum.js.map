{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/oauth/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://@fof/oauth/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://@fof/oauth/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://@fof/oauth/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://@fof/oauth/./src/forum/components/LinkStatus.tsx","webpack://@fof/oauth/./src/forum/components/LinkedAccounts.tsx","webpack://@fof/oauth/./src/forum/components/ProviderInfo.tsx","webpack://@fof/oauth/./src/forum/components/index.ts","webpack://@fof/oauth/./src/forum/extend.ts","webpack://@fof/oauth/./src/forum/extenders/addLinkedAccountsToUserSecurityPage.tsx","webpack://@fof/oauth/./src/forum/extenders/extendLoginSignup.js","webpack://@fof/oauth/./src/forum/index.ts","webpack://@fof/oauth/./src/forum/models/LinkedAccount.ts","webpack://@fof/oauth/./src/forum/query/SsoGambit.tsx","webpack://@fof/oauth/./src/forum/utils/index.ts","webpack://@fof/oauth/./src/forum/utils/popupUtils.ts","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/Model')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/components/Button')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/components/FieldSet')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/components/Icon')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/components/Link')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/components/LoadingIndicator')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/components/Tooltip')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/extenders')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/helpers/humanTime')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/helpers/listItems')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/models/User')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/query/IGambit')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/utils/ItemList')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'common/utils/extractText')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'forum/app')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'forum/components/LogInButton')\"","webpack://@fof/oauth/external root \"flarum.reg.get('core', 'forum/components/LogInButtons')\"","webpack://@fof/oauth/webpack/bootstrap","webpack://@fof/oauth/webpack/runtime/compat get default export","webpack://@fof/oauth/webpack/runtime/define property getters","webpack://@fof/oauth/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/oauth/webpack/runtime/make namespace object","webpack://@fof/oauth/./forum.js"],"sourcesContent":["import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport Link from 'flarum/common/components/Link';\nimport ProviderInfo from './ProviderInfo';\nimport extractText from 'flarum/common/utils/extractText';\nimport Icon from 'flarum/common/components/Icon';\nexport default class LinkStatus extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"state\", {\n      loading: false\n    });\n  }\n  onbeforeupdate(vnode) {\n    super.onbeforeupdate(vnode);\n    if (app.fof_oauth_linkingInProgress && app.fof_oauth_linkingProvider === this.attrs.provider.name()) {\n      this.state.loading = true;\n    } else if (app.fof_oauth_linkingInProgress === false && app.fof_oauth_linkingProvider === this.attrs.provider.name()) {\n      this.state.loading = false;\n      delete app.fof_oauth_linkingInProgress;\n      delete app.fof_oauth_linkingProvider;\n    }\n  }\n  view(vnode) {\n    return m(\"div\", {\n      className: \"LinkedAccountsList-item LinkedAccountsList-item--\".concat(this.attrs.provider.name())\n    }, this.iconView(), this.statusView(), this.actionView());\n  }\n  iconView() {\n    return m(\"div\", {\n      className: \"LinkedAccountsList-item-icon\"\n    }, m(Icon, {\n      name: this.attrs.provider.icon(),\n      className: \"Provider-Icon Provider-Icon--\".concat(this.attrs.provider.name())\n    }));\n  }\n  statusView() {\n    const provider = this.attrs.provider;\n    return m(ProviderInfo, {\n      provider: provider\n    });\n  }\n  actionView() {\n    var _app$session$user;\n    const provider = this.attrs.provider;\n    const user = this.attrs.user;\n    if (provider.linked()) {\n      return m(\"div\", {\n        className: \"LinkedAccountsList-item-actions\"\n      }, m(Button, {\n        className: \"Button FoFLogInButton LogInButton--\".concat(provider.name(), \" LogInButton\").concat(provider.linked() ? '--linked' : '--unlinked'),\n        icon: provider.icon(),\n        onclick: () => this.deleteProvider(provider),\n        loading: this.state.loading\n      }, app.translator.trans('fof-oauth.forum.unlink')));\n    } else if (!provider.orphaned() && (user.id() === ((_app$session$user = app.session.user) == null ? void 0 : _app$session$user.id()) || !app.forum.attribute('fofOauthModerate'))) {\n      return m(\"div\", {\n        className: \"LinkedAccountsList-item-actions\"\n      }, m(Link, {\n        className: \"Button FoFLogInButton LogInButton--\".concat(provider.name()),\n        icon: provider.icon(),\n        href: \"\".concat(app.forum.attribute('baseUrl'), \"/auth/\").concat(provider.name(), \"?linkTo=\").concat(user.id()),\n        loading: this.state.loading,\n        external: true\n      }, app.translator.trans(\"fof-oauth.forum.log_in.with_\".concat(provider.name(), \"_button\"), {\n        provider: app.translator.trans(\"fof-oauth.forum.providers.\".concat(provider.name()))\n      })));\n    }\n    return null;\n  }\n  async deleteProvider(provider) {\n    if (confirm(extractText(app.translator.trans('fof-oauth.forum.user.settings.linked-account.unlink-confirm', {\n      provider: app.translator.trans(\"fof-oauth.forum.providers.\".concat(provider.name()))\n    })))) {\n      this.state.loading = true;\n      await provider.delete();\n      await app.store.find('users/' + this.attrs.user.id() + '/linked-accounts', {});\n      this.state.loading = false;\n      m.redraw();\n    }\n  }\n}\nflarum.reg.add('fof-oauth', 'forum/components/LinkStatus', LinkStatus);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport listItems from 'flarum/common/helpers/listItems';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport LinkStatus from './LinkStatus';\nexport default class LinkedAccounts extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"state\", {\n      loadingAdditional: true,\n      errorLoadingAdditional: false\n    });\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    this.loadLinkedAccounts();\n  }\n  view(vnode) {\n    const linkedAccounts = app.store.all('linked-accounts');\n    return m(FieldSet, {\n      label: app.translator.trans('fof-oauth.forum.user.settings.linked-account.label')\n    }, m(\"p\", {\n      className: \"helpText\"\n    }, app.translator.trans('fof-oauth.forum.user.settings.linked-account.help')), this.state.loadingAdditional ? m(LoadingIndicator, {\n      containerClassName: \"LinkedAccounts-Loading\"\n    }) : m(\"ul\", {\n      className: \"LinkedAccountsList\"\n    }, listItems(this.linkedAccountsItems(linkedAccounts, this.attrs.user).toArray())));\n  }\n  linkedAccountsItems(linkedAccounts, user) {\n    const items = new ItemList();\n    linkedAccounts.forEach(linkedAccount => {\n      items.add(linkedAccount.name(), m(LinkStatus, {\n        provider: linkedAccount,\n        user: user\n      }), linkedAccount.priority());\n    });\n    return items;\n  }\n  async loadLinkedAccounts() {\n    await app.store.find('linked-accounts', {\n      filter: {\n        userId: this.attrs.user.id()\n      }\n    });\n    // await app.store.find<LinkedAccount[]>('users/' + this.attrs.user.id() + '/linked-accounts', {});\n    this.state.loadingAdditional = false;\n    m.redraw();\n  }\n}\nflarum.reg.add('fof-oauth', 'forum/components/LinkedAccounts', LinkedAccounts);","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport humanTime from 'flarum/common/helpers/humanTime';\nimport ItemList from 'flarum/common/utils/ItemList';\nexport default class ProviderInfo extends Component {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n  view(vnode) {\n    const {\n      provider\n    } = this.attrs;\n    if (provider.orphaned()) {\n      return m(\"div\", null, m(\"p\", {\n        className: \"LinkedAccountsList-item-title\"\n      }, provider.name()), m(\"p\", {\n        className: \"helpText\"\n      }, app.translator.trans('fof-oauth.forum.user.settings.linked-account.orphaned-account')), m(\"div\", {\n        className: \"LinkedAccountsList-item-data\"\n      }, this.providerInfoItems(provider).toArray()));\n    }\n    if (provider.linked()) {\n      return m(\"div\", null, m(\"p\", {\n        className: \"LinkedAccountsList-item-title\"\n      }, app.translator.trans(\"fof-oauth.forum.providers.\".concat(provider.name()))), m(\"div\", {\n        className: \"LinkedAccountsList-item-data\"\n      }, this.providerInfoItems(provider).toArray()));\n    }\n    return m(\"div\", null, m(\"p\", {\n      className: \"LinkedAccountsList-item-title\"\n    }, app.translator.trans(\"fof-oauth.forum.providers.\".concat(provider.name()))));\n  }\n  providerInfoItems(provider) {\n    const LabelValue = flarum.reg.get('core', 'common/components/LabelValue');\n    const items = new ItemList();\n    items.add('firstLogin', m(LabelValue, {\n      label: app.translator.trans('fof-oauth.forum.user.settings.linked-account.link-created-label'),\n      value: humanTime(provider.firstLogin())\n    }), 100);\n    items.add('lastLogin', m(LabelValue, {\n      label: app.translator.trans('fof-oauth.forum.user.settings.linked-account.last-used-label'),\n      value: humanTime(provider.lastLogin())\n    }), 90);\n    items.add('identification', m(LabelValue, {\n      label: app.translator.trans('fof-oauth.forum.user.settings.linked-account.identification-label', {\n        provider: app.translator.trans(\"fof-oauth.forum.providers.\".concat(provider.name()))\n      }),\n      value: provider.identifier()\n    }), 80);\n    return items;\n  }\n}\nflarum.reg.add('fof-oauth', 'forum/components/ProviderInfo', ProviderInfo);","import LinkStatus from './LinkStatus';\nimport LinkedAccounts from './LinkedAccounts';\nimport ProviderInfo from './ProviderInfo';\nexport const components = {\n  ProviderInfo,\n  LinkStatus,\n  LinkedAccounts\n};\nflarum.reg.add('fof-oauth', 'forum/components', null);","import Extend from 'flarum/common/extenders';\nimport User from 'flarum/common/models/User';\nimport LinkedAccount from './models/LinkedAccount';\nimport SsoGambit from './query/SsoGambit';\nexport default [new Extend.Model(User) //\n.attribute('loginProvider'), new Extend.Store() //\n.add('linked-accounts', LinkedAccount), new Extend.Search() //\n.gambit('users', SsoGambit)];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport LinkedAccounts from '../components/LinkedAccounts';\nexport default function addLinkedAccountsToUserSecurityPage() {\n  extend('flarum/forum/components/UserSecurityPage', 'settingsItems', function (items) {\n    var _this$user, _app$session$user;\n    if (((_this$user = this.user) == null ? void 0 : _this$user.id()) !== ((_app$session$user = app.session.user) == null ? void 0 : _app$session$user.id()) && !app.forum.attribute('fofOauthModerate')) {\n      return;\n    }\n    items.add('linkedAccounts', m(LinkedAccounts, {\n      user: this.user\n    }), 5);\n  });\n}\nflarum.reg.add('fof-oauth', 'forum/extenders/addLinkedAccountsToUserSecurityPage', addLinkedAccountsToUserSecurityPage);","import app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport LogInButtons from 'flarum/forum/components/LogInButtons';\nimport LogInButton from 'flarum/forum/components/LogInButton';\nimport extractText from 'flarum/common/utils/extractText';\nimport Tooltip from 'flarum/common/components/Tooltip';\n// import type LogInModal from 'flarum/forum/components/LogInModal';\n// import type SignUpModal from 'flarum/forum/components/SignUpModal';\nimport { openOAuthPopup } from '../utils/popupUtils';\nexport default function () {\n  extend(LogInButton, 'initAttrs', function (returnedValue, attrs) {\n    attrs.onclick = function () {\n      openOAuthPopup(app, attrs);\n    };\n  });\n  extend(LogInButtons.prototype, 'items', function (items) {\n    const onlyIcons = !!app.forum.attribute('fof-oauth.only_icons');\n    const buttons = app.forum.attribute('fof-oauth').filter(Boolean);\n    const googleButton = buttons.splice(buttons.indexOf(buttons.find(b => b.name === 'google')), 1);\n    buttons.concat(googleButton).forEach(_ref => {\n      let {\n        name,\n        icon,\n        priority\n      } = _ref;\n      let className = \"Button FoFLogInButton LogInButton--\".concat(name);\n\n      // Google branding does not allow inline icon, so we'll keep the full button\n      if (onlyIcons && name !== 'google') {\n        className += ' Button--icon';\n      }\n      items.add(name, m(\"div\", {\n        className: \"LogInButtonContainer LogInButtonContainer--\".concat(name)\n      }, m(LogInButton, {\n        className: className,\n        icon: icon,\n        path: \"/auth/\".concat(name),\n        disabled: app.fof_oauth_loginInProgress\n      }, app.translator.trans(\"fof-oauth.forum.log_in.with_\".concat(name, \"_button\"), {\n        provider: app.translator.trans(\"fof-oauth.forum.providers.\".concat(name))\n      }))), priority);\n    });\n  });\n  override(LogInButton.prototype, 'view', function (orig, vnode) {\n    const onlyIcons = !!app.forum.attribute('fof-oauth.only_icons');\n    if (!onlyIcons) return orig(vnode);\n    const child = orig(vnode);\n    return m(Tooltip, {\n      text: extractText(child.children[1])\n    }, child);\n  });\n  extend(LogInButtons.prototype, 'view', function (vdom) {\n    const onlyIcons = !!app.forum.attribute('fof-oauth.only_icons');\n    if (!onlyIcons) return;\n    vdom.attrs.className += ' FoFLogInButtons--icons';\n  });\n  extend('flarum/forum/ForumApplication', 'authenticationComplete', function (_, payload) {\n    if (payload.loggedIn) {\n      app.fof_oauth_loginInProgress = true;\n      // This will automatically be reset, as authenticationComplete also triggers a window reload.\n\n      m.redraw();\n    }\n  });\n  override('flarum/forum/ForumApplication', 'authenticationComplete', async function () {\n    try {\n      app.fof_oauth_linkingInProgress = true;\n      m.redraw();\n\n      // Refresh the list of providers\n      const newProviders = await this.store.find('linked-accounts');\n\n      // The store will contain an old version of the login provider (unlinked) that has\n      // another ID than the new one (linked). We need to delete that one from the store\n      // so that the UI gets updated correctly.\n\n      // Find the old provider (one that has the same name as one of the new providers & has providerIdentifier===null)\n      const oldProvider = this.store.all('linked-accounts')\n      // Find the providers that have not yet been linked (providerIdentifier is null)\n      .filter(p => p.providerIdentifier() === null)\n      // Match it with one of the newly fetched providers by name\n      .find(p => newProviders.some(np => np.name() === p.name()));\n      if (oldProvider) {\n        delete this.store.data['linked-accounts'][oldProvider.id()];\n      } else {\n        window.location.reload();\n        return;\n      }\n\n      // Refresh the session user\n      await this.store.find('users', app.session.user.id());\n      app.fof_oauth_linkingInProgress = false;\n      m.redraw();\n    } catch (error) {\n      app.fof_oauth_linkingInProgress = false;\n      m.redraw();\n    }\n  });\n  extend('flarum/forum/components/LogInModal', 'onbeforeupdate', function (vnode) {\n    if (app.fof_oauth_loginInProgress) {\n      this.loading = true;\n    }\n  });\n  extend('flarum/forum/components/SignUpModal', 'onbeforeupdate', function (vnode) {\n    if (app.fof_oauth_loginInProgress) {\n      this.loading = true;\n    }\n  });\n  extend('flarum/forum/components/SignUpModal', 'fields', function (items) {\n    // If a suggested username was not provided by the OAuth service, display some help text to the user.\n    if (!!this.attrs.token && !!!this.attrs.username) {\n      items.add('username-help', m(\"div\", null, m(\"p\", null, app.translator.trans('fof-oauth.forum.signup.username_help'))), 35);\n    }\n    return items;\n  });\n}","import app from 'flarum/forum/app';\nimport addLinkedAccountsToUserSecurityPage from './extenders/addLinkedAccountsToUserSecurityPage';\nimport extendLoginSignup from './extenders/extendLoginSignup';\nexport { default as extend } from './extend';\nexport * from './components';\nexport * from './utils';\napp.initializers.add('fof/oauth', () => {\n  extendLoginSignup();\n  addLinkedAccountsToUserSecurityPage();\n});","import Model from 'flarum/common/Model';\nexport default class LinkedAccount extends Model {\n  name() {\n    return Model.attribute('name').call(this);\n  }\n  icon() {\n    return Model.attribute('icon').call(this);\n  }\n  priority() {\n    return Model.attribute('priority').call(this);\n  }\n  linked() {\n    return Model.attribute('linked').call(this);\n  }\n  orphaned() {\n    return Model.attribute('orphaned').call(this);\n  }\n  identifier() {\n    return Model.attribute('identifier').call(this);\n  }\n  firstLogin() {\n    return Model.attribute('firstLogin', Model.transformDate).call(this);\n  }\n  lastLogin() {\n    return Model.attribute('lastLogin', Model.transformDate).call(this);\n  }\n  userId() {\n    return Model.attribute('userId').call(this);\n  }\n}\nflarum.reg.add('fof-oauth', 'forum/models/LinkedAccount', LinkedAccount);","import app from 'flarum/forum/app';\nimport { KeyValueGambit } from 'flarum/common/query/IGambit';\nexport default class SsoGambit extends KeyValueGambit {\n  key() {\n    return app.translator.trans('fof-oauth.lib.gambits.sso.key', {}, true);\n  }\n  hint() {\n    return app.translator.trans('fof-oauth.lib.gambits.sso.hint', {}, true);\n  }\n  filterKey() {\n    return 'sso';\n  }\n  enabled() {\n    return !!app.forum.attribute('fofOauthModerate');\n  }\n}\nflarum.reg.add('fof-oauth', 'forum/query/SsoGambit', SsoGambit);","import { openOAuthPopup } from './popupUtils';\nexport const utils = {\n  openOAuthPopup\n};\nflarum.reg.add('fof-oauth', 'forum/utils', null);","export function openOAuthPopup(app, attrs) {\n  const fullscreen = app.forum.attribute('fof-oauth.fullscreenPopup');\n  if (fullscreen) {\n    window.open(app.forum.attribute('baseUrl') + attrs.path, 'logInPopup', 'fullscreen=yes');\n  } else {\n    var _$$height, _$$width;\n    const defaultWidth = 580;\n    const defaultHeight = 400;\n    const width = app.forum.attribute('fof-oauth.popupWidth') || defaultWidth;\n    const height = app.forum.attribute('fof-oauth.popupHeight') || defaultHeight;\n    const windowHeight = (_$$height = $(window).height()) != null ? _$$height : 0;\n    const windowWidth = (_$$width = $(window).width()) != null ? _$$width : 0;\n    const top = windowHeight / 2 - height / 2;\n    const left = windowWidth / 2 - width / 2;\n    window.open(app.forum.attribute('baseUrl') + attrs.path, 'logInPopup', \"width=\".concat(width, \",\") + \"height=\".concat(height, \",\") + \"top=\".concat(top, \",\") + \"left=\".concat(left, \",\") + 'status=no,scrollbars=yes,resizable=no');\n  }\n}\nflarum.reg.add('fof-oauth', 'forum/utils/popupUtils', { openOAuthPopup: openOAuthPopup, });","module.exports = flarum.reg.get('core', 'common/Component');","module.exports = flarum.reg.get('core', 'common/Model');","module.exports = flarum.reg.get('core', 'common/components/Button');","module.exports = flarum.reg.get('core', 'common/components/FieldSet');","module.exports = flarum.reg.get('core', 'common/components/Icon');","module.exports = flarum.reg.get('core', 'common/components/Link');","module.exports = flarum.reg.get('core', 'common/components/LoadingIndicator');","module.exports = flarum.reg.get('core', 'common/components/Tooltip');","module.exports = flarum.reg.get('core', 'common/extend');","module.exports = flarum.reg.get('core', 'common/extenders');","module.exports = flarum.reg.get('core', 'common/helpers/humanTime');","module.exports = flarum.reg.get('core', 'common/helpers/listItems');","module.exports = flarum.reg.get('core', 'common/models/User');","module.exports = flarum.reg.get('core', 'common/query/IGambit');","module.exports = flarum.reg.get('core', 'common/utils/ItemList');","module.exports = flarum.reg.get('core', 'common/utils/extractText');","module.exports = flarum.reg.get('core', 'forum/app');","module.exports = flarum.reg.get('core', 'forum/components/LogInButton');","module.exports = flarum.reg.get('core', 'forum/components/LogInButtons');","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\tflarum.reg._webpack_runtimes[\"fof-oauth\"] ||= __webpack_require__;// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/forum';\r\n"],"names":["toPropertyKey","_defineProperty","e","r","t","Object","defineProperty","value","enumerable","configurable","writable","default","_typeof","toPrimitive","Symbol","i","call","TypeError","String","Number","o","iterator","constructor","prototype"],"sourceRoot":""}