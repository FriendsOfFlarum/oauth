(()=>{var t={195:(t,n,r)=>{t.exports=r(236)},236:t=>{var n=function(t){"use strict";var n,r=Object.prototype,e=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,n,r){return Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{c({},"")}catch(t){c=function(t,n,r){return t[n]=r}}function s(t,n,r,e){var o=n&&n.prototype instanceof v?n:v,a=Object.create(o.prototype),i=new E(e||[]);return a._invoke=function(t,n,r){var e=f;return function(o,a){if(e===h)throw new Error("Generator is already running");if(e===p){if("throw"===o)throw a;return O()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var u=I(i,r);if(u){if(u===m)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===f)throw e=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=h;var c=l(t,n,r);if("normal"===c.type){if(e=r.done?p:d,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(e=p,r.method="throw",r.arg=c.arg)}}}(t,r,i),a}function l(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var f="suspendedStart",d="suspendedYield",h="executing",p="completed",m={};function v(){}function g(){}function y(){}var w={};c(w,a,(function(){return this}));var k=Object.getPrototypeOf,b=k&&k(k(N([])));b&&b!==r&&e.call(b,a)&&(w=b);var _=y.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(n){c(t,n,(function(t){return this._invoke(n,t)}))}))}function x(t,n){function r(o,a,i,u){var c=l(t[o],t,a);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==typeof f&&e.call(f,"__await")?n.resolve(f.__await).then((function(t){r("next",t,i,u)}),(function(t){r("throw",t,i,u)})):n.resolve(f).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function a(){return new n((function(n,o){r(t,e,n,o)}))}return o=o?o.then(a,a):a()}}function I(t,r){var e=t.iterator[r.method];if(e===n){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=n,I(t,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=l(e,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=n),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function P(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function A(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function N(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(e.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=n,r.done=!0,r};return i.next=i}}return{next:O}}function O(){return{value:n,done:!0}}return g.prototype=y,c(_,"constructor",y),c(y,"constructor",g),g.displayName=c(y,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===g||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},L(x.prototype),c(x.prototype,i,(function(){return this})),t.AsyncIterator=x,t.async=function(n,r,e,o,a){void 0===a&&(a=Promise);var i=new x(s(n,r,e,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(_),c(_,u,"Generator"),c(_,a,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},t.values=N,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(e,o){return u.type="throw",u.arg=t,r.next=e,o&&(r.method="next",r.arg=n),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],u=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=e.call(i,"catchLoc"),s=e.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=n,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),m}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var o=e.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:N(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=n),m}},t}(t.exports);try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return r.d(n,{a:n}),n},r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};(()=>{"use strict";r.r(e);const t=flarum.core.compat["forum/app"];var n=r.n(t);const o=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/SettingsPage"];var i=r.n(a);function u(t,n,r,e,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?n(c):Promise.resolve(c).then(e,o)}function c(t){return function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function i(t){u(a,e,o,i,c,"next",t)}function c(t){u(a,e,o,i,c,"throw",t)}i(void 0)}))}}function s(t,n){return s=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},s(t,n)}function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n)}var f=r(195),d=r.n(f);const h=flarum.core.compat["common/Component"];var p=r.n(h);const v=flarum.core.compat["common/components/LoadingIndicator"];var g=r.n(v);const y=flarum.core.compat["common/helpers/icon"];var w=r.n(y);const k=flarum.core.compat["common/components/Button"];var b=r.n(k);const _=flarum.core.compat["forum/components/LogInButton"];var L=r.n(_);const x=flarum.core.compat["common/utils/humanTime"];var I=r.n(x);const P=flarum.core.compat["common/utils/extractText"];var A=r.n(P),E=function(t){function r(){for(var n,r=arguments.length,e=new Array(r),o=0;o<r;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this).state={loading:!1},n}l(r,t);var e=r.prototype;return e.onbeforeupdate=function(r){t.prototype.onbeforeupdate.call(this,r),n().fof_oauth_linkingInProgress&&n().fof_oauth_linkingProvider===this.attrs.provider.name()?this.state.loading=!0:!1===n().fof_oauth_linkingInProgress&&n().fof_oauth_linkingProvider===this.attrs.provider.name()&&(this.state.loading=!1,delete n().fof_oauth_linkingInProgress,delete n().fof_oauth_linkingProvider)},e.view=function(t){var r=this,e=this.attrs,o=e.provider,a=e.user,i="Button FoFLogInButton LogInButton--"+o.name()+" LogInButton"+(o.linked()?"--linked":"--unlinked");return m("li",{className:"LinkedAccounts-Account LinkedAccounts-Account--"+o.name()},w()(o.icon(),{className:"Provider-Icon Provider-Icon--"+o.name()}),m("legend",null,o.orphaned()?o.name():n().translator.trans("fof-oauth.forum.providers."+o.name())),o.orphaned()&&m("p",{className:"LinkedAccounts-AccountOrphaned helpText"},w()("fas fa-exclamation-circle"),m("span",null,n().translator.trans("fof-oauth.forum.user.settings.linked-account.orphaned-account"))),m("div",{className:"Provider-Info"},o.linked()&&m("[",null,m("dl",null,m("dt",null,n().translator.trans("fof-oauth.forum.user.settings.linked-account.link-created-label")),m("dd",null,I()(o.firstLogin())),m("dt",null,n().translator.trans("fof-oauth.forum.user.settings.linked-account.last-used-label")),m("dd",null,I()(o.lastLogin())),m("dt",null,n().translator.trans("fof-oauth.forum.user.settings.linked-account.identifier-label",{provider:o.orphaned()?o.name():n().translator.trans("fof-oauth.lib.providers."+o.name())})),m("dd",null,m("code",null,o.providerIdentifier()))),m(b(),{className:i,icon:o.icon(),onclick:function(){return r.deleteProvider(o)},loading:this.state.loading},n().translator.trans("fof-oauth.forum.unlink"))),!o.linked()&&!o.orphaned()&&m("div",{onclick:function(){return n().fof_oauth_linkingProvider=o.name()}},m(L(),{className:i,icon:o.icon(),path:"/auth/"+o.name()+"?linkTo="+a.id(),loading:this.state.loading},n().translator.trans("fof-oauth.forum.log_in.with_"+o.name()+"_button",{provider:n().translator.trans("fof-oauth.forum.providers."+o.name())})))))},e.deleteProvider=function(){var t=c(d().mark((function t(r){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm(A()(n().translator.trans("fof-oauth.forum.user.settings.linked-account.unlink-confirm",{provider:n().translator.trans("fof-oauth.forum.providers."+r.name())})))){t.next=8;break}return this.state.loading=!0,t.next=4,r.delete();case 4:return t.next=6,n().store.find("linked-accounts",{});case 6:this.state.loading=!1,m.redraw();case 8:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}(),r}(p());const N=flarum.core.compat["common/utils/ItemList"];var O=r.n(N),j=function(t){function r(){for(var n,r=arguments.length,e=new Array(r),o=0;o<r;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this).state={loadingAdditional:!0,errorLoadingAdditional:!1},n}l(r,t);var e=r.prototype;return e.oncreate=function(n){t.prototype.oncreate.call(this,n),this.loadLinkedAccounts()},e.view=function(t){var r=this.attrs.user,e=n().store.all("linked-accounts");return m("div",{className:"LinkedAccounts"},m("fieldset",null,m("legend",null,n().translator.trans("fof-oauth.forum.user.settings.linked-account.label")),m("p",{className:"helpText"},n().translator.trans("fof-oauth.forum.user.settings.linked-account.help")),this.state.loadingAdditional&&m(g(),{containerClassName:"LinkedAccounts-Loading"}),this.state.errorLoadingAdditional&&m("p",{className:"LinkedAccounts-LinkedStatus",role:"status"},n().translator.trans("fof-oauth.forum.user.settings.error_loading_additional")),e.length>0&&m("ul",{className:"LinkedAccounts-List"},this.linkedAccountsItems(e,r).toArray())))},e.linkedAccountsItems=function(t,n){var r=new(O());return t.forEach((function(t){r.add(t.name(),m(E,{provider:t,user:n}),t.priority())})),r},e.loadLinkedAccounts=function(){var t=c(d().mark((function t(){return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n().store.find("linked-accounts",{});case 2:this.state.loadingAdditional=!1,m.redraw();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r}(p());const B=flarum.core.compat["forum/components/LogInButtons"];var T=r.n(B);const S=flarum.core.compat["common/components/Tooltip"];var F=r.n(S);const G=flarum.core.compat["forum/components/LogInModal"];var C=r.n(G);const M=flarum.core.compat["forum/components/SignUpModal"];var R=r.n(M);const D=flarum.core.compat["forum/ForumApplication"];var Y=r.n(D);const z=flarum.core.compat["common/Model"];var U=r.n(z),q=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var r=n.prototype;return r.name=function(){return U().attribute("name").call(this)},r.icon=function(){return U().attribute("icon").call(this)},r.priority=function(){return U().attribute("priority").call(this)},r.linked=function(){return U().attribute("linked").call(this)},r.orphaned=function(){return U().attribute("orphaned").call(this)},r.identifier=function(){return U().attribute("identifier").call(this)},r.providerIdentifier=function(){return U().attribute("providerIdentifier").call(this)},r.firstLogin=function(){return U().attribute("firstLogin",U().transformDate).call(this)},r.lastLogin=function(){return U().attribute("lastLogin",U().transformDate).call(this)},n}(U());n().initializers.add("fof/oauth",(function(){n().store.models["linked-accounts"]=q,(0,o.extend)(T().prototype,"items",(function(t){var r=!!n().forum.attribute("fof-oauth.only_icons"),e=n().forum.attribute("fof-oauth").filter(Boolean),o=e.splice(e.indexOf(e.find((function(t){return"google"===t.name}))),1);e.concat(o).forEach((function(e){var o=e.name,a=e.icon,i=e.priority,u="Button FoFLogInButton LogInButton--"+o;r&&"google"!==o&&(u+=" Button--icon"),t.add(o,m("div",{className:"LogInButtonContainer LogInButtonContainer--"+o},m(L(),{className:u,icon:a,path:"/auth/"+o,disabled:n().fof_oauth_loginInProgress},n().translator.trans("fof-oauth.forum.log_in.with_"+o+"_button",{provider:n().translator.trans("fof-oauth.forum.providers."+o)}))),i)}))})),(0,o.override)(L().prototype,"view",(function(t,r){if(!n().forum.attribute("fof-oauth.only_icons"))return t(r);var e=t(r);return m(F(),{text:A()(e.children[1])},e)})),(0,o.extend)(T().prototype,"view",(function(t){n().forum.attribute("fof-oauth.only_icons")&&(t.attrs.className+=" FoFLogInButtons--icons")})),(0,o.extend)(Y().prototype,"authenticationComplete",(function(t,r){r.loggedIn&&(n().fof_oauth_loginInProgress=!0,m.redraw())})),Y().prototype.linkingComplete=c(d().mark((function t(){var r,e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n().fof_oauth_linkingInProgress=!0,m.redraw(),t.next=5,this.store.find("linked-accounts");case 5:if(r=t.sent,!(e=this.store.all("linked-accounts").filter((function(t){return null===t.providerIdentifier()})).find((function(t){return r.some((function(n){return n.name()===t.name()}))})))){t.next=11;break}delete this.store.data["linked-accounts"][e.id()],t.next=13;break;case 11:return window.location.reload(),t.abrupt("return");case 13:return t.next=15,this.store.find("users",n().session.user.id());case 15:n().fof_oauth_linkingInProgress=!1,m.redraw(),t.next=23;break;case 19:t.prev=19,t.t0=t.catch(0),n().fof_oauth_linkingInProgress=!1,m.redraw();case 23:case"end":return t.stop()}}),t,this,[[0,19]])}))),(0,o.extend)(C().prototype,"onbeforeupdate",(function(t){n().fof_oauth_loginInProgress&&(this.loading=!0)})),(0,o.extend)(R().prototype,"onbeforeupdate",(function(t){n().fof_oauth_loginInProgress&&(this.loading=!0)})),(0,o.extend)(R().prototype,"fields",(function(t){return this.attrs.token&&!this.attrs.username&&t.add("username-help",m("div",null,m("p",null,n().translator.trans("fof-oauth.forum.signup.username_help"))),35),t})),(0,o.extend)(i().prototype,"accountItems",(function(t){this.user===n().session.user&&t.add("linkedAccounts",m(j,{user:this.user}),-100)}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map